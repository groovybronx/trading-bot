<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Bot Dashboard</title>
    <link rel="stylesheet" href="style.css">
    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.6/css/jquery.dataTables.min.css">
</head>

<body>
    <header>
        <h1>Trading Bot Dashboard</h1>
    </header>

    <main>
        <div class="top-sections-container"> <!-- Conteneur pour Statut et Stats -->
            <section id="bot-status">
                <h2>Statut du Bot</h2>
                <p>État : <span id="status-value">Inconnu</span></p>
                <p>Stratégie : <span id="strategy-type-value">N/A</span></p>
                <p>Symbole : <span id="symbol-value">N/A</span></p>
                <p>Timeframe : <span id="timeframe-value">N/A</span> <small id="timeframe-relevance">(Pertinent pour SWING)</small></p>
                <p>Balance (<span id="quote-asset-label">USDT</span>) : <span id="balance-value">N/A</span></p>
                <p>Quantité (<span id="base-asset-label">N/A</span>) : <span id="quantity-value">N/A</span></p>
                <p>Prix Actuel (<span id="symbol-price-label">N/A</span>) : <span id="current-price" class="status-value">N/A</span></p>
                <p>Position Actuelle : <span id="position-value">Aucune</span></p>
            </section>

            <section id="stats">
                <h2>Statistiques (Session)</h2> <!-- Titre modifié -->
                <ul>
                    <li>ROI : <span id="stat-roi">N/A</span></li>
                    <li>Winrate : <span id="stat-winrate">N/A</span></li>
                    <li>Trades gagnants : <span id="stat-wins">N/A</span></li>
                    <li>Trades perdants : <span id="stat-losses">N/A</span></li>
                    <li>Nombre total Trades : <span id="stat-total">N/A</span></li>
                    <li>PNL moyen : <span id="stat-avg-pnl">N/A</span></li>
                </ul>
            </section>
        </div> <!-- Fin du conteneur top-sections-container -->

        <!-- NOUVELLE SECTION: Gestion des Sessions -->
        <section id="session-management">
            <h2>Gestion des Sessions</h2>
            <div class="session-controls">
                <label for="session-selector">Session :</label>
                <select id="session-selector">
                    <option value="">Chargement...</option>
                </select>
                <button id="new-session-btn">Nouvelle Session</button>
                <button id="delete-session-btn" disabled>Supprimer Session</button>
                 <span id="session-status-indicator" style="margin-left: 15px; font-weight: bold;"></span>
            </div>
        </section>
        

        <section id="order-history">
            <h2>Historique des Ordres (Session <span id="history-session-id">N/A</span>)</h2> <!-- Titre modifié -->
            <div class="table-container">
                <table id="order-history-table"> <!-- Ajout ID pour DataTables -->
                    <thead>
                        <tr>
                            <th>Date/Heure</th>
                            <th>Symbole</th>
                            <th>Stratégie</th>
                            <th>Side</th>
                            <th>Type</th>
                            <th>Qté Demandée</th>
                            <th>Qté Exécutée</th>
                            <th>Prix / Valeur</th>
                            <th>Valeur (quote)</th>
                            <th>Statut</th>
                            <th>Perf (%)</th>
                            <th>ID Ordre</th>
                        </tr>
                    </thead>
                    <tbody id="order-history-body">
                        <!-- Le contenu sera géré par DataTables -->
                    </tbody>
                </table>
            </div>
        </section>

        <section id="logs">
            <h2>Logs</h2>
            <pre id="log-output">En attente des logs du backend...</pre>
        </section>

        <section id="controls">
            <h2>Contrôles</h2>
            <button id="start-bot-btn">Démarrer le Bot</button>
            <button id="stop-bot-btn" disabled>Arrêter le Bot</button>
            <button id="reset-bot-btn" style="display: none;">Reset Bot</button> <!-- Caché, remplacé par gestion session -->
        </section>

        <section id="parameters">
            <h2>Paramètres de Stratégie</h2>
            <div>
                <label for="param-strategy-type">Type de Stratégie :</label>
                <select id="param-strategy-type" name="STRATEGY_TYPE">
                    <option value="SWING">SWING (EMA/RSI - Kline)</option>
                    <option value="SCALPING">SCALPING (Book Ticker)</option>
                    <option value="SCALPING2">SCALPING2 (Book Ticker + Indicateurs)</option>
                </select>
            </div>
            <hr>
            <section id="general-params">
                <h3>Paramètres Généraux </h3>
                <div class="param-grid">
                    <div><label for="param-risk">Risque par ordre (%) <span style="font-weight:normal;font-size:0.95em;"></span> :</label><input type="number" id="param-risk" name="RISK_PER_TRADE" min="0.1" max="100" step="0.1"></div>
                    <div><label for="param-capital-allocation">Capital investi (%) <span style="font-weight:normal;font-size:0.95em;">(Ex : 10 pour 10%)</span> :</label><input type="number" id="param-capital-allocation" name="CAPITAL_ALLOCATION" min="1" max="100" step="1"></div>
                    <div><label for="param-sl">Stop Loss (%) <span style="font-weight:normal;font-size:0.95em;"></span> :</label><input type="number" id="param-sl" name="STOP_LOSS_PERCENTAGE" min="0.1" max="20" step="0.1"></div>
                    <div><label for="param-tp1">Take Profit 1 (%) <span style="font-weight:normal;font-size:0.95em;"></span> :</label><input type="number" id="param-tp1" name="TAKE_PROFIT_1_PERCENTAGE" min="0.1" max="50" step="0.1"></div>
                    <div><label for="param-tp2">Take Profit 2 (%) <span style="font-weight:normal;font-size:0.95em;"></span> :</label><input type="number" id="param-tp2" name="TAKE_PROFIT_2_PERCENTAGE" min="0.1" max="50" step="0.1"></div>
                    <div><label for="param-trailing">Trailing Stop (%) <span style="font-weight:normal;font-size:0.95em;"></span> :</label><input type="number" id="param-trailing" name="TRAILING_STOP_PERCENTAGE" min="0.1" max="10" step="0.1"></div>
                    <div><label for="param-time-stop">Time Stop (minutes) :</label><input type="number" id="param-time-stop" name="TIME_STOP_MINUTES" min="1" max="240" step="1"></div>
                    <div><label for="param-order-cooldown">Délai minimum entre ordres (ms) :</label><input type="number" id="param-order-cooldown" name="ORDER_COOLDOWN_MS" min="0" step="100"></div>
                </div>
            </section>
            <div id="swing-params">
                <h3>Paramètres SWING</h3>
                <div class="param-grid">
                    <div><label for="param-timeframe">Timeframe :</label><select id="param-timeframe" name="TIMEFRAME_STR"><option value="1m">1m</option><option value="3m">3m</option><option value="5m">5m</option><option value="15m">15m</option><option value="30m">30m</option><option value="1h">1h</option><option value="2h">2h</option><option value="4h">4h</option><option value="6h">6h</option><option value="8h">8h</option><option value="12h">12h</option><option value="1d">1d</option><option value="3d">3d</option><option value="1w">1w</option><option value="1M">1M</option></select></div>
                    <div><label for="param-ema-short">EMA Courte :</label><input type="number" id="param-ema-short" name="EMA_SHORT_PERIOD" min="1" step="1"></div>
                    <div><label for="param-ema-long">EMA Longue :</label><input type="number" id="param-ema-long" name="EMA_LONG_PERIOD" min="2" step="1"></div>
                    <div><label for="param-ema-filter">EMA Filtre :</label><input type="number" id="param-ema-filter" name="EMA_FILTER_PERIOD" min="1" step="1"></div>
                    <div><label for="param-rsi-period">Période RSI :</label><input type="number" id="param-rsi-period" name="RSI_PERIOD" min="2" step="1"></div>
                    <div><label for="param-rsi-ob">RSI Surachat :</label><input type="number" id="param-rsi-ob" name="RSI_OVERBOUGHT" min="51" max="100" step="1"></div>
                    <div><label for="param-rsi-os">RSI Survente :</label><input type="number" id="param-rsi-os" name="RSI_OVERSOLD" min="0" max="49" step="1"></div>
                    <div><label for="param-volume-avg">Moy. Vol. Période :</label><input type="number" id="param-volume-avg" name="VOLUME_AVG_PERIOD" min="1" step="1"></div>
                    <div class="checkbox-group"><input type="checkbox" id="param-use-ema-filter" name="USE_EMA_FILTER"><label for="param-use-ema-filter">Utiliser Filtre EMA</label></div>
                    <div class="checkbox-group"><input type="checkbox" id="param-use-volume" name="USE_VOLUME_CONFIRMATION"><label for="param-use-volume">Utiliser Confirmation Volume</label></div>
                </div>
            </div>
            <div id="scalping-params" style="display: none;">
                <h3>Paramètres SCALPING</h3>
                <div class="param-grid">
                    <div><label for="param-scalping-order-type">Type d'ordre :</label><select id="param-scalping-order-type" name="SCALPING_ORDER_TYPE"><option value="MARKET">MARKET</option><option value="LIMIT">LIMIT</option></select></div>
                    <div><label for="param-scalping-limit-tif">Time in Force (LIMIT) :</label><select id="param-scalping-limit-tif" name="SCALPING_LIMIT_TIF"><option value="GTC">GTC</option><option value="IOC">IOC</option><option value="FOK">FOK</option></select></div>
                    <div><label for="param-scalping-limit-timeout">Timeout LIMIT (ms) :</label><input type="number" id="param-scalping-limit-timeout" name="SCALPING_LIMIT_ORDER_TIMEOUT_MS" min="1000" max="60000" step="1000" value="5000"></div>
                    <div><label for="param-scalping-depth-levels">Niveaux Carnet :</label><input type="number" id="param-scalping-depth-levels" name="SCALPING_DEPTH_LEVELS" min="1" max="20" step="1" value="5"></div>
                    <div><label for="param-scalping-depth-speed">Vitesse Carnet :</label><select id="param-scalping-depth-speed" name="SCALPING_DEPTH_SPEED"><option value="100ms">100ms</option><option value="1000ms">1000ms</option></select></div>
                    <div><label for="param-scalping-spread-threshold">Seuil Spread :</label><input type="number" id="param-scalping-spread-threshold" name="SCALPING_SPREAD_THRESHOLD" min="0.00001" max="0.01" step="0.00001" value="0.0001"></div>
                    <div><label for="param-scalping-imbalance-threshold">Seuil Imbalance :</label><input type="number" id="param-scalping-imbalance-threshold" name="SCALPING_IMBALANCE_THRESHOLD" min="1" max="10" step="0.1" value="1.5"></div>
                </div>
            </div>
            <div id="scalping2-specific-params" style="display: none;">
                <h3>Paramètres SCALPING 2 (Indicateurs)</h3>
                <div class="param-grid">
                    <div><label for="param-supertrend-atr">Supertrend ATR Période :</label><input type="number" id="param-supertrend-atr" name="SUPERTREND_ATR_PERIOD" min="1" step="1"></div>
                    <div><label for="param-supertrend-mult">Supertrend Multiplicateur :</label><input type="number" id="param-supertrend-mult" name="SUPERTREND_ATR_MULTIPLIER" min="0.1" step="0.1"></div>
                    <div><label for="param-rsi-period-scalp">RSI Période :</label><input type="number" id="param-rsi-period-scalp" name="SCALPING_RSI_PERIOD" min="2" step="1"></div>
                    <div><label for="param-stoch-k">Stochastique %K :</label><input type="number" id="param-stoch-k" name="STOCH_K_PERIOD" min="1" step="1"></div>
                    <div><label for="param-stoch-d">Stochastique %D :</label><input type="number" id="param-stoch-d" name="STOCH_D_PERIOD" min="1" step="1"></div>
                    <div><label for="param-stoch-smooth">Stochastique Lissage :</label><input type="number" id="param-stoch-smooth" name="STOCH_SMOOTH" min="1" step="1"></div>
                    <div><label for="param-bb-period">Bandes Bollinger Période :</label><input type="number" id="param-bb-period" name="BB_PERIOD" min="2" step="1"></div>
                    <div><label for="param-bb-std">Bandes Bollinger Écart-Type :</label><input type="number" id="param-bb-std" name="BB_STD" min="0.1" step="0.1"></div>
                    <div><label for="param-vol-ma">Moy. Mobile Volume Période :</label><input type="number" id="param-vol-ma" name="VOLUME_MA_PERIOD" min="1" step="1"></div>
                </div>
            </div>
            <button id="save-params-btn">Sauvegarder les Paramètres</button>
            <p id="param-save-status"></p>
        </section>
    </main>

    <footer>
        <p>&copy; 2025 Votre Bot de Trading</p>
    </footer>

    <!-- jQuery (requis par DataTables) -->
    <script src="https://code.jquery.com/jquery-3.7.0.min.js"></script>
    <!-- DataTables JS -->
    <script type="text/javascript" charset="utf8" src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>
    <!-- Notre script -->
    <script type="module" src="main.js"></script> <!-- Charger le script principal comme module -->
</body>

</html>
